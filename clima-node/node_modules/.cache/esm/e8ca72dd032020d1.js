let loadJson,saveJSON,chalk,mongoWrite;_032‍.x([["get_clima",()=>get_clima]]);_032‍.w("./jsonCRUD",[["loadJson",["loadJson"],function(v){loadJson=v}],["saveJSON",["saveJSON"],function(v){saveJSON=v}]]);_032‍.w("chalk",[["default",["chalk"],function(v){chalk=v}]]);_032‍.w("./dbWrite",[["mongoWrite",["mongoWrite"],function(v){mongoWrite=v}]]);


const ProgressBar = require("./ProgressBar");

var axios = require("axios");
let listofTemps = [];
let mongoObj = [];
       async function get_clima(api) {
  const apikey = api;
  const climaJSON = loadJson("clima-node/src/json/longLangByCity.json");
  const Bar = new ProgressBar();

  let c;
  let apiLimit = 4;
  Bar.init(apiLimit);

  // console logs
  _032‍.g.console.log(chalk.blue("-"));
  _032‍.g.console.log(chalk.blue("--"));
  _032‍.g.console.log(chalk.blue("---"));
  _032‍.g.console.log("", chalk.green.bold("Downloading weather data."));
  _032‍.g.console.log(chalk.blue("---"));
  _032‍.g.console.log(chalk.blue("--"));
  _032‍.g.console.log(chalk.blue("-"));

  for (c = 0; c < apiLimit; c++) {
    let n = c + 1;
    Bar.update(n);
    await axios
      .get("https://api.climacell.co/v3/weather/realtime?lat=" + climaJSON[c][1].toString() + "&lon=" + climaJSON[c][0].toString() + "&unit_system=us&fields=temp%2Cfeels_like&apikey=" + apikey)
      .then((response) => {
        let z = JSON.stringify(response.data.temp.value);
        let x = { temp: z, city: climaJSON[c][3], state: climaJSON[c][4], longitude: climaJSON[c][0], latitude: climaJSON[c][1] };
        let n = [z, climaJSON[c][3], climaJSON[c][0], climaJSON[c][1]];
        mongoObj.push(x);
        listofTemps.push(n);
      })
      .catch((error) => {
        _032‍.g.console.log(error);
      });
  }
  saveJSON("clima-node/src/json/finaltemps.json", listofTemps);
  return mongoObj;
}
